# ComfyUI Web Service

ä¸€ä¸ªåŸºäº FastAPI å’Œ Celery çš„ ComfyUI åˆ†å¸ƒå¼ Web æœåŠ¡ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§ AI å†…å®¹ç”Ÿæˆä»»åŠ¡çš„ç»Ÿä¸€ç®¡ç†å’Œè°ƒåº¦ã€‚

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

- [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) - Docker ä¸€é”®éƒ¨ç½² / ä¼ ç»Ÿéƒ¨ç½²
- [ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†](#ï¸-æ•°æ®åº“ç®¡ç†) - è¿ç§»ç³»ç»Ÿå’Œæ•°æ®åº“æ¶æ„
- [ğŸ³ Docker éƒ¨ç½²](#-docker-éƒ¨ç½²) - å®¹å™¨åŒ–éƒ¨ç½²æŒ‡å—
- [âš™ï¸ é…ç½®è¯´æ˜](#ï¸-é…ç½®è¯´æ˜) - ç³»ç»Ÿé…ç½®å’Œå·¥ä½œæµç®¡ç†
- [ğŸŒ è®¿é—®æœåŠ¡](#-è®¿é—®æœåŠ¡) - æœåŠ¡åœ°å€å’ŒåŠŸèƒ½ä»‹ç»
- [ğŸ“ é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„) - å®Œæ•´çš„ç›®å½•ç»“æ„è¯´æ˜
- [ğŸ”§ é«˜çº§åŠŸèƒ½](#-é«˜çº§åŠŸèƒ½) - æ•°æ®åº“è¿ç§»ã€Dockerç®¡ç†ç­‰
- [ğŸš¨ æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤) - å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

## ğŸŒŸ ç‰¹æ€§

- ğŸ¨ **å¤šæ¨¡æ€å†…å®¹ç”Ÿæˆ**: æ”¯æŒæ–‡ç”Ÿå›¾ã€SDXLã€å›¾ç”Ÿè§†é¢‘ç­‰å¤šç§ AI ç”Ÿæˆä»»åŠ¡
- ğŸ—ï¸ **åˆ†å¸ƒå¼æ¶æ„**: æ”¯æŒä¸€å°ä¸»æœºè°ƒåº¦å™¨ + å¤šå°ä»æœºComfyUIèŠ‚ç‚¹çš„åˆ†å¸ƒå¼éƒ¨ç½²
- âš–ï¸ **æ™ºèƒ½è´Ÿè½½å‡è¡¡**: å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè‡ªåŠ¨ä»»åŠ¡åˆ†å‘å’Œæ•…éšœè½¬ç§»
- ğŸ”§ **èŠ‚ç‚¹ç®¡ç†**: è‡ªåŠ¨èŠ‚ç‚¹å‘ç°ã€å¥åº·æ£€æŸ¥ã€çŠ¶æ€ç›‘æ§
- ğŸ“ **é…ç½®é©±åŠ¨**: é€šè¿‡ YAML é…ç½®æ–‡ä»¶ç®¡ç†å·¥ä½œæµå’Œå‚æ•°æ˜ å°„
- ğŸŒ **RESTful API**: å®Œæ•´çš„ REST API æ¥å£ï¼Œæ”¯æŒä»»åŠ¡æäº¤ã€çŠ¶æ€æŸ¥è¯¢ã€ç»“æœè·å–
- ğŸ’» **åŒç«¯ç•Œé¢**: HTML å®¢æˆ·ç«¯ + Vue.js ç®¡ç†åå°ï¼Œæ”¯æŒå±€åŸŸç½‘è®¿é—®
- ğŸ“Š **å®æ—¶ç›‘æ§**: WebSocket å®æ—¶ä»»åŠ¡è¿›åº¦ç›‘æ§å’Œé›†ç¾¤çŠ¶æ€ç›‘æ§
- ğŸ“‹ **ä»»åŠ¡ç®¡ç†**: æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§ã€æ‰¹é‡å¤„ç†ã€çŠ¶æ€è¿½è¸ª
- ğŸ” **èº«ä»½è®¤è¯**: å®¢æˆ·ç«¯ç”¨æˆ·ç®¡ç†å’Œä¼šè¯æ§åˆ¶
- ğŸ—„ï¸ **ä¸‰æ•°æ®åº“æ¶æ„**: å®¢æˆ·ç«¯ã€ç®¡ç†ç«¯ã€å…±äº«æ•°æ®åˆ†ç¦»å­˜å‚¨
- ğŸ”„ **æ•°æ®åº“è¿ç§»**: ç‰ˆæœ¬åŒ–çš„æ•°æ®åº“ç»“æ„ç®¡ç†ï¼Œæ”¯æŒè‡ªåŠ¨è¿ç§»
- ğŸ³ **å®Œæ•´å®¹å™¨åŒ–**: Docker + Docker Compose ä¸€é”®éƒ¨ç½²
- ğŸš€ **é«˜å¯ç”¨æ€§**: æ•…éšœè‡ªåŠ¨æ£€æµ‹ã€ä»»åŠ¡é‡æ–°åˆ†é…ã€æœåŠ¡è‡ªæ„ˆ

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### åˆ†å¸ƒå¼æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚    â”‚  Vue.js Admin   â”‚    â”‚   Mobile App    â”‚
â”‚   (HTML/JS)     â”‚    â”‚   Dashboard     â”‚    â”‚   (Future)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸»æœºè°ƒåº¦å™¨ (Master)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   API Gateway   â”‚  â”‚  Task Scheduler â”‚  â”‚  Node Manager   â”‚ â”‚
â”‚  â”‚   (FastAPI)     â”‚  â”‚   (Celery)      â”‚  â”‚   (Registry)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Load Balancer   â”‚  â”‚ Health Monitor  â”‚  â”‚ Config Manager  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           â”‚           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ComfyUI-1  â”‚ â”‚ComfyUI-2  â”‚ â”‚ComfyUI-N  â”‚
            â”‚(Worker)   â”‚ â”‚(Worker)   â”‚ â”‚(Worker)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

- **API Gateway**: ç»Ÿä¸€APIå…¥å£ï¼Œå¤„ç†è®¤è¯å’Œè·¯ç”±
- **Task Scheduler**: åŸºäºCeleryçš„å¼‚æ­¥ä»»åŠ¡è°ƒåº¦å™¨
- **Node Manager**: èŠ‚ç‚¹æ³¨å†Œã€å‘ç°å’ŒçŠ¶æ€ç®¡ç†
- **Load Balancer**: æ™ºèƒ½è´Ÿè½½å‡è¡¡å’Œä»»åŠ¡åˆ†å‘
- **Health Monitor**: èŠ‚ç‚¹å¥åº·æ£€æŸ¥å’Œæ•…éšœæ£€æµ‹
- **Config Manager**: é…ç½®ç®¡ç†å’Œçƒ­æ›´æ–°
- **Database Migration**: ç‰ˆæœ¬åŒ–æ•°æ®åº“ç»“æ„ç®¡ç†
- **Container Orchestration**: Docker å®¹å™¨ç¼–æ’å’Œéƒ¨ç½²

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **GPU**: NVIDIA GPU (æ¨è 8GB+ VRAM)
- **å†…å­˜**: 16GB+ RAM
- **å­˜å‚¨**: 50GB+ å¯ç”¨ç©ºé—´

### è½¯ä»¶è¦æ±‚
- **Python**: 3.10+
- **ComfyUI**: æœ€æ–°ç‰ˆæœ¬
- **Redis**: 3.2.100+
- **MySQL**: 8.0+
- **Docker**: 20.10+ (æ¨èå®¹å™¨åŒ–éƒ¨ç½²)
- **Docker Compose**: 2.0+ (æ”¯æŒ `docker compose` å’Œ `docker-compose`)
- **Node.js**: 16+ (ç”¨äºå‰ç«¯å¼€å‘)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd ComfyUI-Web-Service
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
cd docker/
cp .env .env.local
# ç¼–è¾‘ .env.local æ–‡ä»¶ï¼Œä¿®æ”¹æ•°æ®åº“å¯†ç ã€ComfyUIèŠ‚ç‚¹åœ°å€ç­‰é…ç½®
```

#### 3. ä¸€é”®éƒ¨ç½²
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™ (Linux/macOS)
chmod +x deploy.sh

# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
./deploy.sh build
./deploy.sh start -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy.sh status
```

**Windows ç”¨æˆ·**: åœ¨ Git Bash æˆ– WSL ä¸­è¿è¡Œä¸Šè¿°å‘½ä»¤

#### 4. è®¿é—®æœåŠ¡
- å®¢æˆ·ç«¯ç•Œé¢: http://localhost:8001
- ç®¡ç†åå°: http://localhost:8002
- API æ–‡æ¡£: http://localhost:8000/docs

### æ–¹å¼äºŒï¼šä¼ ç»Ÿéƒ¨ç½²

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd ComfyUI-Web-Service

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
.venv\Scripts\activate  # Windows
# source .venv/bin/activate  # Linux/Mac

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

#### 2. æ•°æ®åº“é…ç½®

é…ç½® `backend/config.yaml` ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œç„¶ååˆå§‹åŒ–æ•°æ®åº“ï¼š

```bash
# ä½¿ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·åˆå§‹åŒ–
python database/tools/db_manager.py init

# è¿™ä¼šè‡ªåŠ¨ï¼š
# 1. åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
# 2. æ‰§è¡Œæ‰€æœ‰è¿ç§»
# 3. åˆå§‹åŒ–é»˜è®¤æ•°æ®
```

#### 3. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ Redis
redis-server

# å¯åŠ¨ Celery Worker
cd backend
celery -A app.queue.celery_app worker --loglevel=info

# å¯åŠ¨ FastAPI æœåŠ¡
cd backend
uvicorn app.main_v2:app --host 0.0.0.0 --port 8000 --reload

# å¯åŠ¨å®¢æˆ·ç«¯æœåŠ¡
cd scripts
python start_client.py

# å¯åŠ¨ç®¡ç†åå°æœåŠ¡
cd scripts
python start_admin.py

## ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†

### æ•°æ®åº“æ¶æ„

é¡¹ç›®é‡‡ç”¨**ä¸‰æ•°æ®åº“åˆ†ç¦»æ¶æ„**ï¼š

- **å®¢æˆ·ç«¯æ•°æ®åº“** (comfyui_client): å­˜å‚¨å®¢æˆ·ç«¯ç”¨æˆ·æ•°æ®å’ŒåŸºç¡€ä»»åŠ¡ä¿¡æ¯
- **ç®¡ç†åå°æ•°æ®åº“** (comfyui_admin): å­˜å‚¨ç³»ç»Ÿç®¡ç†ã€é…ç½®å’Œç›‘æ§æ•°æ®
- **å…±äº«æ•°æ®åº“** (comfyui_shared): å­˜å‚¨éœ€è¦è·¨ç³»ç»Ÿè®¿é—®çš„æ ¸å¿ƒæ•°æ®

### æ•°æ®åº“è¿ç§»ç³»ç»Ÿ

é¡¹ç›®åŒ…å«å®Œæ•´çš„æ•°æ®åº“è¿ç§»ç³»ç»Ÿï¼Œæ”¯æŒç‰ˆæœ¬åŒ–çš„æ•°æ®åº“ç»“æ„ç®¡ç†ï¼š

```bash
# æŸ¥çœ‹è¿ç§»çŠ¶æ€
python database/tools/db_manager.py migration-status

# è¿è¡Œè¿ç§»
python database/tools/db_manager.py migrate

# åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
python database/tools/create_migration.py create add_new_field --database client --description "æ·»åŠ æ–°å­—æ®µ"
```

### ç›®å½•ç»“æ„

```
database/
â”œâ”€â”€ README.md                    # æ•°æ®åº“ç®¡ç†è¯´æ˜
â”œâ”€â”€ schema/                      # æ•°æ®åº“ç»“æ„æ–‡ä»¶
â”‚   â”œâ”€â”€ client_database.sql      # å®¢æˆ·ç«¯æ•°æ®åº“ç»“æ„
â”‚   â”œâ”€â”€ admin_database.sql       # ç®¡ç†åå°æ•°æ®åº“ç»“æ„
â”‚   â””â”€â”€ shared_database.sql      # å…±äº«æ•°æ®åº“ç»“æ„
â”œâ”€â”€ migrations/                  # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â””â”€â”€ tools/                       # æ•°æ®åº“ç®¡ç†å·¥å…·
    â”œâ”€â”€ db_manager.py            # ä¸»è¦æ•°æ®åº“ç®¡ç†å·¥å…·
    â”œâ”€â”€ migration_manager.py     # è¿ç§»ç®¡ç†å™¨
    â””â”€â”€ create_migration.py      # åˆ›å»ºè¿ç§»æ–‡ä»¶å·¥å…·
```

## ğŸ³ Docker éƒ¨ç½²

### Docker Compose é…ç½®

é¡¹ç›®æä¾›å®Œæ•´çš„ Docker å®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆï¼š

```
docker/
â”œâ”€â”€ Dockerfile                   # ä¸»åº”ç”¨é•œåƒ
â”œâ”€â”€ docker-compose.yml           # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ docker-compose.prod.yml      # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ deploy.sh                    # éƒ¨ç½²ç®¡ç†è„šæœ¬
â”œâ”€â”€ start.sh                     # å®¹å™¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ .env                         # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ ...
```

### éƒ¨ç½²å‘½ä»¤

```bash
# å¼€å‘ç¯å¢ƒéƒ¨ç½²
cd docker/
./deploy.sh build
./deploy.sh start -d

# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
./deploy.sh -p build
./deploy.sh -p start -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy.sh status

# æŸ¥çœ‹æ—¥å¿—
./deploy.sh logs

# è¿è¡Œæ•°æ®åº“è¿ç§»
./deploy.sh migrate

# å¤‡ä»½æ•°æ®
./deploy.sh backup /path/to/backup
```

### æœåŠ¡ç«¯å£

- **FastAPI ä¸»æœåŠ¡**: http://localhost:8000
- **å®¢æˆ·ç«¯ç•Œé¢**: http://localhost:8001
- **ç®¡ç†åå°**: http://localhost:8002
- **API æ–‡æ¡£**: http://localhost:8000/docs

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»é…ç½®æ–‡ä»¶

ç¼–è¾‘ `backend/config.yaml` æ–‡ä»¶ï¼š
```yaml
# MySQL æ•°æ®åº“é…ç½®
mysql:
  client:
    host: localhost
    port: 3306
    user: root
    password: "123456"
    database: comfyui_client
  admin:
    host: localhost
    port: 3306
    user: root
    password: "123456"
    database: comfyui_admin
  shared:
    host: localhost
    port: 3306
    user: root
    password: "123456"
    database: comfyui_shared

# Redis é…ç½®
redis:
  host: localhost
  port: 6379
  db: 0

# ComfyUI èŠ‚ç‚¹é…ç½®
nodes:
  static_nodes:
    - node_id: "comfyui-worker-1"
      host: "192.168.1.101"  # ComfyUI æœåŠ¡å™¨IP
      port: 8188
      max_concurrent: 4
      capabilities: ["text_to_image", "image_to_video"]

# å·¥ä½œæµé…ç½®
task_types:
  text_to_image:
    workflows:
      sd_basic:
        workflow_file: "workflows/text_to_image/æ–‡ç”Ÿå›¾.json"
  image_to_video:
    workflows:
      svd_basic:
        workflow_file: "workflows/image_to_video/å›¾ç”Ÿè§†é¢‘.json"
```

## ğŸŒ è®¿é—®æœåŠ¡

### æœåŠ¡åœ°å€

- **å®¢æˆ·ç«¯ç•Œé¢**: http://localhost:8001
- **ç®¡ç†åå°**: http://localhost:8002
- **API æ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

### ç®¡ç†åå°åŠŸèƒ½

- ğŸ“Š **ä»ªè¡¨æ¿**: ç³»ç»Ÿæ¦‚è§ˆå’Œå®æ—¶ç»Ÿè®¡
- ğŸ–¥ï¸ **èŠ‚ç‚¹ç®¡ç†**: æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ã€è´Ÿè½½ã€å¥åº·æ£€æŸ¥
- ğŸ“‹ **ä»»åŠ¡ç®¡ç†**: ä»»åŠ¡åˆ—è¡¨ã€çŠ¶æ€ç›‘æ§ã€å†å²è®°å½•
- ğŸ‘¥ **ç”¨æˆ·ç®¡ç†**: ç”¨æˆ·æƒé™å’Œè®¿é—®æ§åˆ¶
- âš™ï¸ **ç³»ç»Ÿé…ç½®**: è´Ÿè½½å‡è¡¡ç­–ç•¥ã€ç³»ç»Ÿå‚æ•°
- ğŸ—„ï¸ **æ•°æ®åº“ç®¡ç†**: è¿ç§»çŠ¶æ€ã€æ•°æ®ç»Ÿè®¡

## ğŸ“ é¡¹ç›®ç»“æ„

```
ComfyUI-Web-Service/
â”œâ”€â”€ README.md                           # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ requirements.txt                    # Pythonä¾èµ–
â”œâ”€â”€ backend/                            # åç«¯åº”ç”¨
â”‚   â”œâ”€â”€ config.yaml                     # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ app/                            # åº”ç”¨æ ¸å¿ƒä»£ç 
â”‚   â”‚   â”œâ”€â”€ admin_api/                  # ç®¡ç†åå°API
â”‚   â”‚   â”œâ”€â”€ api/                        # å®¢æˆ·ç«¯API
â”‚   â”‚   â”œâ”€â”€ auth/                       # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ core/                       # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ database/                   # æ•°æ®åº“æ¨¡å‹å’Œè¿æ¥
â”‚   â”‚   â”œâ”€â”€ processors/                 # ä»»åŠ¡å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ queue/                      # Celeryä»»åŠ¡é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ services/                   # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ outputs/                        # ç”Ÿæˆæ–‡ä»¶è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ uploads/                        # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ workflows/                      # ComfyUIå·¥ä½œæµæ–‡ä»¶
â”œâ”€â”€ frontend/                           # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ client/                         # å®¢æˆ·ç«¯ç•Œé¢
â”‚   â””â”€â”€ admin/                          # ç®¡ç†åå°ç•Œé¢ (Vue.js)
â”œâ”€â”€ database/                           # æ•°æ®åº“ç®¡ç† â­
â”‚   â”œâ”€â”€ README.md                       # æ•°æ®åº“ä½¿ç”¨è¯´æ˜
â”‚   â”œâ”€â”€ setup_databases.sql             # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ schema/                         # æ•°æ®åº“ç»“æ„æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ client_database.sql         # å®¢æˆ·ç«¯æ•°æ®åº“ç»“æ„
â”‚   â”‚   â”œâ”€â”€ admin_database.sql          # ç®¡ç†åå°æ•°æ®åº“ç»“æ„
â”‚   â”‚   â””â”€â”€ shared_database.sql         # å…±äº«æ•°æ®åº“ç»“æ„
â”‚   â”œâ”€â”€ migrations/                     # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â””â”€â”€ tools/                          # æ•°æ®åº“ç®¡ç†å·¥å…·
â”‚       â”œâ”€â”€ db_manager.py               # ä¸»è¦æ•°æ®åº“ç®¡ç†å·¥å…·
â”‚       â”œâ”€â”€ migration_manager.py        # è¿ç§»ç®¡ç†å™¨
â”‚       â””â”€â”€ create_migration.py         # åˆ›å»ºè¿ç§»æ–‡ä»¶å·¥å…·
â”œâ”€â”€ docker/                             # Dockerå®¹å™¨åŒ–é…ç½® â­
â”‚   â”œâ”€â”€ Dockerfile                      # ä¸»åº”ç”¨é•œåƒ
â”‚   â”œâ”€â”€ docker-compose.yml             # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ docker-compose.prod.yml        # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ deploy.sh                       # éƒ¨ç½²ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ start.sh                        # å®¹å™¨å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ ...
â”œâ”€â”€ scripts/                            # å¯åŠ¨è„šæœ¬
â””â”€â”€ docs/                               # æ–‡æ¡£
    â”œâ”€â”€ Dockerå®¹å™¨åŒ–éƒ¨ç½²æŒ‡å—.md
    â””â”€â”€ é¡¹ç›®ç»“æ„è¯´æ˜.md
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### æ•°æ®åº“è¿ç§»

```bash
# æŸ¥çœ‹è¿ç§»çŠ¶æ€
python database/tools/db_manager.py migration-status

# åˆ›å»ºæ–°è¿ç§»
python database/tools/create_migration.py create add_new_field --database client

# æ‰§è¡Œè¿ç§»
python database/tools/db_manager.py migrate
```

### Docker ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./docker/deploy.sh status

# æŸ¥çœ‹æ—¥å¿—
./docker/deploy.sh logs

# å¤‡ä»½æ•°æ®
./docker/deploy.sh backup

# æ›´æ–°æœåŠ¡
./docker/deploy.sh update
```

### å·¥ä½œæµé…ç½®

ç³»ç»Ÿé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†å·¥ä½œæµå‚æ•°æ˜ å°„ï¼š

```yaml
task_types:
  text_to_image:
    workflows:
      sd_basic:
        workflow_file: "workflows/text_to_image/æ–‡ç”Ÿå›¾.json"
        parameter_mapping:
          prompt:
            node_id: "314"
            input_name: "text"
            default_value: ""
          width:
            node_id: "135"
            input_name: "width"
            default_value: 512
```

### å‚æ•°ä¼˜å…ˆçº§

1. **å‰ç«¯æäº¤å‚æ•°** (æœ€é«˜ä¼˜å…ˆçº§)
2. **é…ç½®æ–‡ä»¶é»˜è®¤å€¼**
3. **å·¥ä½œæµåŸå§‹å€¼** (æœ€ä½ä¼˜å…ˆçº§)

## ğŸ” èº«ä»½è®¤è¯

### å®¢æˆ·ç«¯è®¤è¯

```bash
# 1. åˆ›å»ºå®¢æˆ·ç«¯
POST /api/v2/auth/register
{
  "client_name": "test_client",
  "description": "æµ‹è¯•å®¢æˆ·ç«¯"
}

# 2. è·å–è®¿é—®ä»¤ç‰Œ
POST /api/v2/auth/token
{
  "client_id": "your_client_id",
  "client_secret": "your_client_secret"
}
```

### ç®¡ç†åå°è®¤è¯

```bash
POST /admin/auth/login
{
  "username": "admin",
  "password": "admin"
}
```

## ğŸ“¡ æ–°å¢APIæ¥å£

### å›¾ç”Ÿè§†é¢‘æ¥å£

```bash
POST /api/v2/tasks/image-to-video
Content-Type: application/json
Authorization: Bearer <token>

{
  "image_path": "path/to/image.png",
  "duration": 30,
  "fps": 30,
  "workflow_name": "image_to_video_basic"
}
```

### SDXLæ–‡ç”Ÿå›¾æ¥å£

```bash
POST /api/v2/tasks/text-to-image-sdxl
Content-Type: application/json
Authorization: Bearer <token>

{
  "prompt": "a beautiful landscape",
  "negative_prompt": "blurry, low quality",
  "width": 1024,
  "height": 1024,
  "workflow_name": "sdxl_basic"
}
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹èŠ‚ç‚¹æ€§èƒ½æŒ‡æ ‡
GET /api/v2/admin/performance/nodes

# æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡
GET /api/v2/admin/performance/tasks
```

### æ—¥å¿—ç®¡ç†

- ç³»ç»Ÿæ—¥å¿—: `backend/logs/system.log`
- è®¿é—®æ—¥å¿—: `backend/logs/access.log`
- é”™è¯¯æ—¥å¿—: `backend/logs/error.log`
- Celery æ—¥å¿—: `backend/logs/celery.log`

## ğŸš¨ æ•…éšœæ’é™¤

### Docker ç¯å¢ƒé—®é¢˜

1. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹å®¹å™¨æ—¥å¿—
   ./docker/deploy.sh logs

   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
   ./docker/deploy.sh status
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€
   docker-compose ps mysql

   # æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
   docker-compose logs mysql
   ```

3. **ç«¯å£å†²çª**
   ```bash
   # ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ç«¯å£é…ç½®
   FASTAPI_PORT=8080
   CLIENT_PORT=8081
   ADMIN_PORT=8082
   ```

### ä¼ ç»Ÿéƒ¨ç½²é—®é¢˜

1. **ComfyUI è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ ComfyUI æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - éªŒè¯é…ç½®æ–‡ä»¶ä¸­çš„ host å’Œ port

2. **Redis è¿æ¥å¤±è´¥**
   - ç¡®ä¿ Redis æœåŠ¡å·²å¯åŠ¨
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

3. **å·¥ä½œæµæ‰§è¡Œå¤±è´¥**
   - æ£€æŸ¥å·¥ä½œæµæ–‡ä»¶è·¯å¾„
   - éªŒè¯å‚æ•°æ˜ å°„é…ç½®
   - æŸ¥çœ‹ Celery Worker æ—¥å¿—

4. **æ•°æ®åº“è¿æ¥é—®é¢˜**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
   python database/tools/db_manager.py status

   # è¿è¡Œè¿ç§»
   python database/tools/db_manager.py migrate
   ```

5. **è®¤è¯å¤±è´¥**
   - æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ
   - éªŒè¯client_idå’Œclient_secret
   - ç¡®è®¤è¯·æ±‚å¤´æ ¼å¼æ­£ç¡®

### æ€§èƒ½ä¼˜åŒ–

- è°ƒæ•´ Celery Worker æ•°é‡
- é…ç½® Redis å†…å­˜é™åˆ¶
- ä¼˜åŒ–å·¥ä½œæµå‚æ•°
- ä½¿ç”¨ Docker èµ„æºé™åˆ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ· Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [ComfyUI](https://github.com/comfyanonymous/ComfyUI) - å¼ºå¤§çš„ AI å›¾åƒç”Ÿæˆå·¥å…·
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„ Python Web æ¡†æ¶
- [Celery](https://docs.celeryproject.org/) - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- [Vue.js](https://vuejs.org/) - æ¸è¿›å¼ JavaScript æ¡†æ¶

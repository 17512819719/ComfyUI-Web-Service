# ComfyUI Web Service

# 2025å¹´6æœˆ24æ—¥é‡æ„è¯´æ˜

æœ¬æ¬¡é‡æ„ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š

- å®ç°äº†å‰åç«¯å½»åº•åˆ†ç¦»ï¼Œåç«¯ä»£ç ã€ä¾èµ–ã€é…ç½®å…¨éƒ¨å½’æ¡£äº backend ç›®å½•
- åç«¯ä¸šåŠ¡ä»£ç å…¨éƒ¨å½’æ¡£äº backend/app åŒ…ï¼Œimport è·¯å¾„å·²ä¿®æ­£ä¸ºç›¸å¯¹å¯¼å…¥ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- Redis ç›¸å…³ä¾èµ–å·²è¿ç§»è‡³ backend/ï¼Œåç«¯ä¾èµ–ç»Ÿä¸€ç®¡ç†
- ç§»é™¤äº†ç®¡ç†åå°åŠŸèƒ½ï¼Œé¡¹ç›®ç»“æ„æ›´ç®€æ´
- ç›®å½•ç»“æ„å’Œå¯åŠ¨æ–¹å¼å·²åœ¨æ–‡æ¡£ä¸­æ›´æ–°ï¼Œä¾¿äºæ–°æˆå‘˜ç†è§£å’Œä½¿ç”¨

<div align="center">

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)
![Celery](https://img.shields.io/badge/Celery-5.3+-orange.svg)
![Redis](https://img.shields.io/badge/Redis-3.2+-red.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

**åŸºäºFastAPIå’ŒCeleryçš„ComfyUIåˆ†å¸ƒå¼AIæœåŠ¡**

[ğŸš€ å¿«é€Ÿå¼€å§‹](#--å¿«é€Ÿå¼€å§‹) â€¢ [ğŸ“– APIæ–‡æ¡£](#--apiæ–‡æ¡£) â€¢ [âš™ï¸ é…ç½®è¯´æ˜](#--é…ç½®è¯´æ˜) â€¢ [ğŸ”§ æ•…éšœæ’é™¤](#--æ•…éšœæ’é™¤)

</div>

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#-é¡¹ç›®ç®€ä»‹)
- [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
- [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„)
- [ç³»ç»Ÿè¦æ±‚](#-ç³»ç»Ÿè¦æ±‚)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [APIæ–‡æ¡£](#-apiæ–‡æ¡£)
- [å®¢æˆ·ç«¯ä½¿ç”¨](#-å®¢æˆ·ç«¯ä½¿ç”¨)
- [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)
- [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [æ›´æ–°æ—¥å¿—](#-æ›´æ–°æ—¥å¿—)

## ğŸ¯ é¡¹ç›®ç®€ä»‹

ComfyUI Web Service æ˜¯ä¸€ä¸ªåŸºäº FastAPI å’Œ Celery çš„åˆ†å¸ƒå¼ AI æœåŠ¡ï¼Œä¸º ComfyUI æä¾› RESTful API æ¥å£ã€‚æ”¯æŒæ–‡ç”Ÿå›¾ï¼ˆText-to-Imageï¼‰å’Œå›¾ç”Ÿè§†é¢‘ï¼ˆImage-to-Videoï¼‰åŠŸèƒ½ï¼Œå…·å¤‡å¼‚æ­¥ä»»åŠ¡å¤„ç†ã€è¿›åº¦ç›‘æ§ã€åˆ†å¸ƒå¼èŠ‚ç‚¹æ”¯æŒç­‰ç‰¹æ€§ã€‚

### ä¸»è¦åº”ç”¨åœºæ™¯

- ğŸ¤– AI å†…å®¹åˆ›ä½œå¹³å°
- ğŸ¨ å›¾åƒç”ŸæˆæœåŠ¡
- ğŸ¬ è§†é¢‘åˆ¶ä½œå·¥å…·
- ğŸ”„ æ‰¹é‡å›¾åƒå¤„ç†
- ğŸŒ åˆ†å¸ƒå¼ AI æ¨ç†

## âœ¨ åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½æ¨¡å— | æè¿° | çŠ¶æ€ |
|---------|------|------|
| ğŸ¨ **æ–‡ç”Ÿå›¾** | æ”¯æŒå¤šç§é‡‡æ ·å™¨å’Œæ¨¡å‹ï¼Œå¯é…ç½®å‚æ•° | âœ… |
| ğŸ¬ **å›¾ç”Ÿè§†é¢‘** | åŸºäºå›¾åƒç”ŸæˆåŠ¨æ€è§†é¢‘å†…å®¹ | âœ… |
| ğŸ”„ **å¼‚æ­¥å¤„ç†** | Celery ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒé•¿æ—¶é—´è¿è¡Œä»»åŠ¡ | âœ… |
| ğŸ“Š **è¿›åº¦ç›‘æ§** | å®æ—¶ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦æŸ¥è¯¢ | âœ… |
| ğŸŒ **åˆ†å¸ƒå¼æ”¯æŒ** | å¤šèŠ‚ç‚¹ ComfyUI æœåŠ¡è´Ÿè½½å‡è¡¡ | âœ… |
| ğŸ”„ **å¤šå·¥ä½œæµæ”¯æŒ** | æ”¯æŒè‡ªå®šä¹‰/åˆ‡æ¢å¤šç§ç”Ÿæˆæµç¨‹ | âœ… |
| ğŸ©º **èŠ‚ç‚¹å¥åº·ç®¡ç†** | èŠ‚ç‚¹çŠ¶æ€é‡ç½®ä¸å¡æ­»æ£€æµ‹ä¿®å¤ | âœ… |
| â³ **ä»»åŠ¡é¢„ä¼°æ—¶é—´** | ä»»åŠ¡çŠ¶æ€è¿”å›é¢„ä¼°å‰©ä½™æ—¶é—´ | âœ… |
| ğŸ” **èº«ä»½è®¤è¯** | JWT Token è®¤è¯æœºåˆ¶ | âœ… |
| ğŸ“ **æ–‡ä»¶ç®¡ç†** | è‡ªåŠ¨æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½å’Œæ¸…ç† | âœ… |
| ğŸš€ **æœåŠ¡ç®¡ç†** | ä¸€é”®å¯åŠ¨/åœæ­¢æ‰€æœ‰æœåŠ¡ | âœ… |
| ğŸ“ **APIæ–‡æ¡£** | è‡ªåŠ¨ç”Ÿæˆçš„ Swagger æ–‡æ¡£ | âœ… |
| ğŸ–¥ï¸ **Webå®¢æˆ·ç«¯** | å†…ç½®ç°ä»£åŒ– Web ç•Œé¢ | âœ… |

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚    â”‚   FastAPI       â”‚    â”‚   Celery        â”‚
â”‚   (HTML/JS)     â”‚â—„â”€â”€â–ºâ”‚   (API Server)  â”‚â—„â”€â”€â–ºâ”‚   (Task Queue)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Redis         â”‚    â”‚   ComfyUI       â”‚
                       â”‚   (Cache/Queue) â”‚    â”‚   (AI Engine)   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶è¯´æ˜

- **FastAPI**: Web API æœåŠ¡å™¨ï¼Œå¤„ç† HTTP è¯·æ±‚
- **Celery**: å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ AI ä»»åŠ¡
- **Redis**: æ¶ˆæ¯ä»£ç†å’Œç¼“å­˜å­˜å‚¨
- **ComfyUI**: AI æ¨¡å‹æ¨ç†å¼•æ“
- **Web Client**: ç°ä»£åŒ– Web ç•Œé¢ï¼Œæä¾›ç”¨æˆ·äº¤äº’

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### æœ€ä½é…ç½®

- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, Linux, macOS
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**: 8GB RAM
- **å­˜å‚¨**: 10GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥

### æ¨èé…ç½®

- **æ“ä½œç³»ç»Ÿ**: Windows 11 æˆ– Ubuntu 20.04+
- **Python**: 3.9 æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**: 16GB RAM æˆ–æ›´é«˜
- **GPU**: NVIDIA GPU (8GB+ VRAM)
- **å­˜å‚¨**: SSD å­˜å‚¨ï¼Œ50GB+ å¯ç”¨ç©ºé—´

### å¿…éœ€è½¯ä»¶

- âœ… Python 3.8+
- âœ… ComfyUI (éœ€è¦å•ç‹¬å®‰è£…)
- âœ… Redis (å·²åŒ…å«åœ¨é¡¹ç›®ä¸­)
- âœ… è¶³å¤Ÿçš„ GPU å†…å­˜ç”¨äº AI æ¨¡å‹æ¨ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£… Python 3.8+ å’Œ ComfyUIï¼š

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬
python --version

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½® ComfyUI

ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼Œé…ç½® ComfyUI è·¯å¾„å’Œç«¯å£ï¼š

```yaml
comfyui:
  port: 8188
  output_dir: "E:\\ComfyUI\\ComfyUI\\output"
```

### 3. å¯åŠ¨ ComfyUI æœåŠ¡

**é‡è¦**: å¿…é¡»å…ˆå¯åŠ¨ ComfyUI æœåŠ¡ï¼Œå†å¯åŠ¨å…¶ä»–æœåŠ¡ã€‚

```bash
# è¿›å…¥ ComfyUI å®‰è£…ç›®å½•
cd E:\ComfyUI\ComfyUI

# å¯åŠ¨ ComfyUI æœåŠ¡
python main.py --listen 0.0.0.0 --port 8188
```

### 4. å¯åŠ¨ Web Service

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆRedisã€Celery Workerã€FastAPIï¼‰
python start_services.py
```

### 5. è®¿é—®æœåŠ¡

- **Web å®¢æˆ·ç«¯**: http://localhost:8000
- **API æ–‡æ¡£**: http://localhost:8000/docs
- **ComfyUI ç•Œé¢**: http://localhost:8188

### 6. åœæ­¢æœåŠ¡

```bash
# åœæ­¢ Web Serviceï¼ˆRedisã€Celery Workerã€FastAPIï¼‰
python stop_services.py

# æ‰‹åŠ¨åœæ­¢ ComfyUI æœåŠ¡
# åœ¨ ComfyUI ç»ˆç«¯æŒ‰ Ctrl+C
```

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
# ComfyUI é…ç½®
comfyui:
  port: 8188                    # ComfyUI æœåŠ¡ç«¯å£
  output_dir: "E:\\ComfyUI\\ComfyUI\\output"  # è¾“å‡ºç›®å½•

# æ–‡ç”Ÿå›¾é…ç½®
text_to_image:
  ckpt_name: realisticVisionV60B1_v51HyperVAE.safetensors  # æ¨¡å‹æ–‡ä»¶
  sampler_name: euler          # é‡‡æ ·å™¨
  scheduler: normal            # è°ƒåº¦å™¨
  default_width: 512           # é»˜è®¤å®½åº¦
  default_height: 512          # é»˜è®¤é«˜åº¦
  default_steps: 20            # é»˜è®¤æ­¥æ•°
  default_cfg_scale: 7.0       # é»˜è®¤ CFG æ¯”ä¾‹

# å›¾ç”Ÿè§†é¢‘é…ç½®
image_to_video:
  model_name: realisticVisionV60B1_v51HyperVAE.safetensors  # æ¨¡å‹æ–‡ä»¶
  default_fps: 8               # é»˜è®¤å¸§ç‡
  default_duration: 5.0        # é»˜è®¤æ—¶é•¿
  default_motion_strength: 0.8 # é»˜è®¤è¿åŠ¨å¼ºåº¦
```

### ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | æè¿° |
|--------|--------|------|
| `COMFYUI_PORT` | 8188 | ComfyUI æœåŠ¡ç«¯å£ |
| `REDIS_URL` | redis://localhost:6379/0 | Redis è¿æ¥åœ°å€ |
| `API_HOST` | 0.0.0.0 | API æœåŠ¡å™¨ä¸»æœº |
| `API_PORT` | 8000 | API æœåŠ¡å™¨ç«¯å£ |

### é…ç½®ä¼˜å…ˆçº§è¯´æ˜
- å‚æ•°ä¼˜å…ˆçº§ï¼šå·¥ä½œæµç‰¹å®šè®¾ç½® > ä»»åŠ¡ç±»å‹ç‰¹å®šè®¾ç½® > å…¨å±€é»˜è®¤è®¾ç½® > ç¡¬ç¼–ç é»˜è®¤å€¼
- æ”¯æŒåœ¨ `workflow_config.json` ä¸­ä¸ºæ¯ä¸ªå·¥ä½œæµå•ç‹¬é…ç½®å‚æ•°å’Œæè¿°

## ğŸ“– APIæ–‡æ¡£

### è®¤è¯

æ‰€æœ‰ API è¯·æ±‚éƒ½éœ€è¦ Bearer Token è®¤è¯ï¼š

```bash
# ç™»å½•è·å– Token
curl -X POST "http://localhost:8000/api/auth/login" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=z&password=z"

# ä½¿ç”¨ Token
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:8000/api/endpoint
```

### æ–‡ç”Ÿå›¾ API

#### æäº¤ç”Ÿæˆä»»åŠ¡

```bash
curl -X POST "http://localhost:8000/api/generate/image" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "prompt=a beautiful landscape&width=512&height=512&workflow_template=æ ‡å‡†æ–‡ç”Ÿå›¾"
```

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|------|------|------|--------|------|
| `prompt` | string | âœ… | - | æ­£å‘æç¤ºè¯ |
| `negative_prompt` | string | âŒ | "" | è´Ÿå‘æç¤ºè¯ |
| `width` | integer | âŒ | 512 | å›¾åƒå®½åº¦ |
| `height` | integer | âŒ | 512 | å›¾åƒé«˜åº¦ |
| `steps` | integer | âŒ | 20 | é‡‡æ ·æ­¥æ•° |
| `cfg_scale` | float | âŒ | 7.0 | CFG æ¯”ä¾‹ |
| `seed` | integer | âŒ | -1 | éšæœºç§å­ |
| `batch_size` | integer | âŒ | 1 | æ‰¹é‡å¤§å° |
| `workflow_template` | string | âŒ | æ ‡å‡†æ–‡ç”Ÿå›¾ | å·¥ä½œæµæ¨¡æ¿åç§°ï¼ˆå¯é€‰ï¼‰ |

**å“åº”ç¤ºä¾‹**:

```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "queued",
  "message": "ä»»åŠ¡å·²æäº¤åˆ°é˜Ÿåˆ—"
}
```

### å›¾ç”Ÿè§†é¢‘ API

#### æäº¤è§†é¢‘ç”Ÿæˆä»»åŠ¡

```bash
curl -X POST "http://localhost:8000/api/generate/video" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -F "image=@input.jpg" \
     -F "duration=5.0" \
     -F "fps=8" \
     -F "workflow_template=ä¸‡ç›¸2.1å›¾ç”Ÿè§†é¢‘"
```

**è¯·æ±‚å‚æ•°**:

| å‚æ•° | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|------|------|------|--------|------|
| `image` | file | âœ… | - | è¾“å…¥å›¾åƒæ–‡ä»¶ |
| `duration` | float | âŒ | 5.0 | è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ |
| `fps` | integer | âŒ | 8 | å¸§ç‡ |
| `motion_strength` | float | âŒ | 0.8 | è¿åŠ¨å¼ºåº¦ |
| `workflow_template` | string | âŒ | ä¸‡ç›¸2.1å›¾ç”Ÿè§†é¢‘ | å·¥ä½œæµæ¨¡æ¿åç§°ï¼ˆå¯é€‰ï¼‰ |

### ä»»åŠ¡çŠ¶æ€ API

#### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl -X GET "http://localhost:8000/api/task/status/TASK_ID" \
     -H "Authorization: Bearer YOUR_TOKEN"
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "processing",
  "progress": 75,
  "message": "æ­£åœ¨ç”Ÿæˆå›¾åƒ...",
  "result_url": null,
  "error_message": null,
  "estimated_time": 120,
  "created_at": "2024-06-25T12:00:00Z",
  "updated_at": "2024-06-25T12:01:00Z"
}
```

**çŠ¶æ€è¯´æ˜**ï¼š
- `status` å¯èƒ½ä¸º `queued`ã€`processing`ã€`completed`ã€`failed`ã€`cancelled`
- `estimated_time` ä¸ºé¢„ä¼°å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰

#### ä¸‹è½½ç»“æœ

```bash
curl -X GET "http://localhost:8000/api/download/TASK_ID" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -o "result.png"
```

### ç³»ç»ŸçŠ¶æ€ API

#### å¥åº·æ£€æŸ¥

```bash
curl -X GET "http://localhost:8000/api/health"
```

## ğŸ–¥ï¸ å®¢æˆ·ç«¯ä½¿ç”¨

é¡¹ç›®å†…ç½®äº†ç°ä»£åŒ–çš„ Web å®¢æˆ·ç«¯ï¼Œæä¾›ç›´è§‚çš„ç”¨æˆ·ç•Œé¢ï¼š

### è®¿é—®å®¢æˆ·ç«¯

1. å¯åŠ¨æœåŠ¡åï¼Œè®¿é—® http://localhost:8000
2. ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•ï¼š
   - ç”¨æˆ·å: `z`
   - å¯†ç : `z`

### åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ **æ–‡ç”Ÿå›¾ç•Œé¢**: ç›´è§‚çš„å‚æ•°é…ç½®å’Œå®æ—¶é¢„è§ˆ
- ğŸ¬ **å›¾ç”Ÿè§†é¢‘ç•Œé¢**: æ‹–æ‹½ä¸Šä¼ å’Œå‚æ•°è°ƒæ•´
- ğŸ“Š **ä»»åŠ¡ç›‘æ§**: å®æ—¶ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦æ˜¾ç¤º
- ğŸ“ **æ–‡ä»¶ç®¡ç†**: ç»“æœæ–‡ä»¶ä¸‹è½½å’Œç®¡ç†
- ğŸ”„ **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡å›¾åƒç”Ÿæˆ

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ComfyUI å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: å¯åŠ¨è„šæœ¬æç¤º "ComfyUI æœåŠ¡æœªè¿è¡Œ"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ ComfyUI æ˜¯å¦æ­£ç¡®å®‰è£…
ls E:\ComfyUI\ComfyUI\main.py

# 2. æ‰‹åŠ¨å¯åŠ¨ ComfyUI
cd E:\ComfyUI\ComfyUI
python main.py --listen 0.0.0.0 --port 8188

# 3. éªŒè¯æœåŠ¡çŠ¶æ€
curl http://localhost:8188/system_stats
```

#### 2. Redis å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: Redis æœåŠ¡æ— æ³•å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ Redis æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls Redis-x64-3.2.100/redis-server.exe

# 2. æ‰‹åŠ¨å¯åŠ¨ Redis
Redis-x64-3.2.100\redis-server.exe

# 3. éªŒè¯ Redis è¿æ¥
python -c "import redis; r=redis.Redis(); r.ping()"
```

#### 3. ç«¯å£å†²çª

**ç—‡çŠ¶**: ç«¯å£è¢«å ç”¨é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :8188
netstat -ano | findstr :8000

# 2. ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£
# ç¼–è¾‘ config.yaml æ–‡ä»¶

# 3. åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F
```

#### 4. GPU å†…å­˜ä¸è¶³

**ç—‡çŠ¶**: CUDA out of memory é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
- å‡å°‘ `batch_size` å‚æ•°
- é™ä½å›¾åƒåˆ†è¾¨ç‡
- å…³é—­å…¶ä»– GPU åº”ç”¨ç¨‹åº
- ä½¿ç”¨ CPU æ¨¡å¼ï¼ˆå¦‚æœæ”¯æŒï¼‰

#### 5. æ¨¡å‹æ–‡ä»¶ç¼ºå¤±

**ç—‡çŠ¶**: æ¨¡å‹åŠ è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥æ¨¡å‹æ–‡ä»¶è·¯å¾„
ls E:\ComfyUI\ComfyUI\models\checkpoints\

# 2. ä¸‹è½½æ‰€éœ€æ¨¡å‹æ–‡ä»¶
# å°†æ¨¡å‹æ–‡ä»¶æ”¾å…¥ ComfyUI/models/checkpoints/ ç›®å½•

# 3. æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å‹åç§°
# ç¼–è¾‘ config.yaml æ–‡ä»¶
```

### æ—¥å¿—è°ƒè¯•

#### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# FastAPI æ—¥å¿—
tail -f logs/fastapi.log

# Celery Worker æ—¥å¿—
tail -f logs/celery.log

# ComfyUI æ—¥å¿—
# æŸ¥çœ‹ ComfyUI æ§åˆ¶å°è¾“å‡º
```

#### å¯ç”¨è°ƒè¯•æ¨¡å¼

```bash
# å¯åŠ¨è°ƒè¯•æ¨¡å¼
python start_services.py --debug

# æˆ–æ‰‹åŠ¨å¯åŠ¨å¸¦è¯¦ç»†æ—¥å¿—
uvicorn main:app --reload --log-level debug
```

### æ€§èƒ½ä¼˜åŒ–

#### ç³»ç»Ÿä¼˜åŒ–å»ºè®®

1. **GPU ä¼˜åŒ–**:
   - ä½¿ç”¨æœ€æ–°æ˜¾å¡é©±åŠ¨
   - å¯ç”¨ CUDA ä¼˜åŒ–
   - ç›‘æ§ GPU æ¸©åº¦å’ŒåŠŸè€—

2. **å†…å­˜ä¼˜åŒ–**:
   - å¢åŠ ç³»ç»Ÿå†…å­˜
   - ä½¿ç”¨ SSD å­˜å‚¨
   - å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

3. **ç½‘ç»œä¼˜åŒ–**:
   - ä½¿ç”¨æœ‰çº¿ç½‘ç»œè¿æ¥
   - é…ç½®åˆé€‚çš„é˜²ç«å¢™è§„åˆ™
   - ä¼˜åŒ–ç½‘ç»œå»¶è¿Ÿ

## ğŸ‘¨â€ğŸ’» å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
ComfyUI-Web-Service/
â”‚
â”œâ”€â”€ backend/                # åç«¯ä»£ç ï¼ˆFastAPIç­‰ï¼‰
â”‚   â”œâ”€â”€ app/                # ä¸šåŠ¡ä»£ç ï¼ˆAPIã€modelsã€utilsç­‰ï¼‰
â”‚   â”œâ”€â”€ workflows/          # å·¥ä½œæµé…ç½®
â”‚   â”œâ”€â”€ outputs/            # è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ uploads/            # ä¸Šä¼ ç›®å½•
â”‚   â”œâ”€â”€ Redis-x64-3.2.100/  # redisç›¸å…³
â”‚   â”œâ”€â”€ config.yaml         # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt    # Pythonä¾èµ–
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Client/                 # Webå®¢æˆ·ç«¯
â””â”€â”€ ...
```

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd ComfyUI-Web-Service

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate     # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. å®‰è£…å¼€å‘ä¾èµ–
pip install pytest black flake8 mypy

# 5. é…ç½®å¼€å‘ç¯å¢ƒ
cp config.yaml.example config.yaml
# ç¼–è¾‘ config.yaml
```

### ä»£ç è§„èŒƒ

```bash
# ä»£ç æ ¼å¼åŒ–
black .

# ä»£ç æ£€æŸ¥
flake8 .

# ç±»å‹æ£€æŸ¥
mypy .

# è¿è¡Œæµ‹è¯•
pytest
```

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ·»åŠ æ–°çš„ API ç«¯ç‚¹**:
   - åœ¨ `main.py` ä¸­å®šä¹‰è·¯ç”±
   - åœ¨ `models.py` ä¸­å®šä¹‰æ•°æ®æ¨¡å‹
   - åœ¨ `tasks.py` ä¸­å®šä¹‰ Celery ä»»åŠ¡

2. **æ·»åŠ æ–°çš„ ComfyUI å·¥ä½œæµ**:
   - åœ¨ `workflows/` ç›®å½•ä¸­æ·»åŠ  JSON æ–‡ä»¶
   - åœ¨ `tasks.py` ä¸­å®ç°å·¥ä½œæµé€»è¾‘

3. **æ‰©å±•å®¢æˆ·ç«¯åŠŸèƒ½**:
   - ä¿®æ”¹ `Client/Client-ComfyUI.html`
   - æ·»åŠ æ–°çš„ JavaScript å‡½æ•°
   - æ›´æ–° CSS æ ·å¼

### è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

### è‡ªå®šä¹‰/æ‰©å±•å·¥ä½œæµæ¨¡æ¿
1. åœ¨ `backend/workflows/` ç›®å½•æ·»åŠ æ–°çš„ JSON å·¥ä½œæµæ–‡ä»¶ã€‚
2. åœ¨ `workflow_config.json` ä¸­è¡¥å……æè¿°ã€åˆ†ç±»å’Œé»˜è®¤å‚æ•°ã€‚
3. å¯é€šè¿‡ API æˆ–å‰ç«¯ç•Œé¢åˆ‡æ¢å’Œé€‰æ‹©ä¸åŒå·¥ä½œæµã€‚

### è°ƒè¯•ä¸èŠ‚ç‚¹ç®¡ç†
- ä½¿ç”¨ `/api/debug/tasks` æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡çŠ¶æ€ã€‚
- ä½¿ç”¨ `/api/debug/reset-nodes` é‡ç½®æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€å¹¶ä¿®å¤å¡æ­»èŠ‚ç‚¹ã€‚

## ğŸ“ æ›´æ–°æ—¥å¿—

### ğŸ†• æœ€è¿‘æ›´æ–°

- é‡æ„ï¼šå®ç°å‰åç«¯å½»åº•åˆ†ç¦»ï¼Œåç«¯ä»£ç ã€ä¾èµ–ã€é…ç½®å…¨éƒ¨å½’æ¡£äº backend ç›®å½•ï¼Œç›®å½•ç»“æ„å’Œå¯åŠ¨æ–¹å¼åŒæ­¥æ›´æ–°ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚
- ç§»é™¤äº†ç®¡ç†åå°åŠŸèƒ½ï¼Œé¡¹ç›®ç»“æ„æ›´ç®€æ´ã€‚
- é‡æ„æ–‡ç”Ÿå›¾å·¥ä½œæµæ¨¡å—ï¼Œå·¥ä½œæµä¸å†ç¡¬ç¼–ç ï¼Œé€šè¿‡ç‰¹å®š workflow json æ–‡ä»¶å®ç°ï¼Œæ”¯æŒè‡ªå®šä¹‰å’Œæ‰©å±•ã€‚
- æ–°å¢ `workflow_manager.py`ã€`workflow_selector.py`ï¼Œæ”¯æŒå¤šå·¥ä½œæµé…ç½®å’Œé€‰æ‹©ã€‚
- workflows ç›®å½•ç»“æ„è°ƒæ•´ï¼Œæ”¯æŒå¤šç§å·¥ä½œæµ json æ–‡ä»¶ã€‚

### ğŸ—‚ï¸ å·¥ä½œæµæ¨¡å—è¯´æ˜

- `workflow_manager.py`ï¼šç”¨äºåŠ è½½å’Œç®¡ç†ä¸åŒçš„å·¥ä½œæµé…ç½®ã€‚
- `workflow_selector.py`ï¼šç”¨äºé€‰æ‹©å’Œåˆ‡æ¢å½“å‰ä½¿ç”¨çš„å·¥ä½œæµã€‚
- `workflows/`ï¼šå­˜æ”¾æ‰€æœ‰å¯ç”¨çš„å·¥ä½œæµ json æ–‡ä»¶ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‰©å±•ã€‚

### v1.2.0 (2024-01-XX)

#### ğŸš€ æ–°åŠŸèƒ½
- âœ¨ é‡æ„æœåŠ¡ç®¡ç†æ–¹å¼ï¼ŒComfyUI éœ€è¦æ‰‹åŠ¨å¯åŠ¨
- âœ¨ æ”¹è¿›æœåŠ¡çŠ¶æ€æ£€æµ‹å’Œé”™è¯¯å¤„ç†
- âœ¨ ä¼˜åŒ–é…ç½®æ–‡ä»¶ç»“æ„å’Œå‚æ•°éªŒè¯

#### ğŸ”§ æ”¹è¿›
- ğŸ”„ ç®€åŒ–å¯åŠ¨æµç¨‹ï¼Œæé«˜ç¨³å®šæ€§
- ğŸ“ æ›´æ–°æ–‡æ¡£å’Œæ•…éšœæ’é™¤æŒ‡å—
- ğŸ› ä¿®å¤å¤šä¸ªå·²çŸ¥é—®é¢˜

#### ğŸ› ä¿®å¤
- ä¿®å¤æœåŠ¡å¯åŠ¨é¡ºåºé—®é¢˜
- ä¿®å¤é…ç½®æ–‡ä»¶åŠ è½½é”™è¯¯
- ä¿®å¤ä»»åŠ¡çŠ¶æ€æ›´æ–°é—®é¢˜

### v1.1.0 (2024-01-XX)

#### ğŸš€ æ–°åŠŸèƒ½
- âœ¨ æ–°å¢ ComfyUI æœåŠ¡è‡ªåŠ¨æ£€æµ‹å’Œå¯åŠ¨
- âœ¨ æ–°å¢é…ç½®æ–‡ä»¶æ”¯æŒ
- âœ¨ æ”¹è¿›æœåŠ¡ç®¡ç†è„šæœ¬
- âœ¨ æ–°å¢æœåŠ¡çŠ¶æ€æ£€æµ‹åŠŸèƒ½

#### ğŸ”§ æ”¹è¿›
- ğŸ”„ ä¼˜åŒ–ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
- ğŸ“Š æ”¹è¿›è¿›åº¦ç›‘æ§æœºåˆ¶
- ğŸ›¡ï¸ å¢å¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### v1.0.0 (2024-01-XX)

#### ğŸ‰ åˆå§‹ç‰ˆæœ¬
- âœ¨ åŸºç¡€æ–‡ç”Ÿå›¾å’Œå›¾ç”Ÿè§†é¢‘åŠŸèƒ½
- âœ¨ FastAPI + Celery æ¶æ„
- âœ¨ Redis ç¼“å­˜æ”¯æŒ
- âœ¨ JWT è®¤è¯æœºåˆ¶
- âœ¨ Web å®¢æˆ·ç«¯ç•Œé¢

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ¤ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š

1. ğŸ“– æŸ¥çœ‹ [æ•…éšœæ’é™¤](#--æ•…éšœæ’é™¤) éƒ¨åˆ†
2. ğŸ” æœç´¢ [Issues](../../issues)
3. ğŸ’¬ åˆ›å»ºæ–°çš„ Issue
4. ğŸ“§ è”ç³»ç»´æŠ¤è€…

---

<div align="center">

**Made with â¤ï¸ by the ComfyUI Web Service Team**

[â­ Star this project](https://github.com/17512819719/comfyui-web-service)

</div>

## è¯´æ˜
- `backend/`ï¼šåç«¯æœåŠ¡ï¼ŒåŒ…å«APIã€ä¸šåŠ¡é€»è¾‘ã€é…ç½®ã€ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ã€‚

---

> é¡¹ç›®ç»“æ„ã€å¯åŠ¨æ–¹å¼å‡å·²æ ‡å‡†åŒ–ï¼Œé€‚åˆå›¢é˜Ÿåä½œå’ŒæŒç»­æ‰©å±•ã€‚